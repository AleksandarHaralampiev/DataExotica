{% extends 'profile.html' %}
{% block content %}
<div class="mb-auto d-flex flex-column flex-lg-row align-items-center justify-content-center w-100 overflow-auto">

    <!--Blog-->
    <div class="info-card w-50 px-4 py-3 my-4 me-3" style="height: 56vh;">
      <h1 class="header">{{ post.title }}</h1>
        
      <h6><i>By {{ post.user }}</i></h6>
        
      <hr>
      
      <div class="mt-3 mb-4">
        <i class="header" style="color: gray;">Description:</i>
        <div class="description-container overflow-auto" style="max-height: 200px;">
          {% for line in post.description.splitlines() %}
            <p class="text-wrap" style="overflow-wrap: break-word;">{{ line }}</p>
          {% endfor %}
        </div>
      </div>
      <a href="{{ url_for('blog') }}" class="border-0 rounded-pill py-2 view-password-btn card-link text-decoration-none" style="min-width: 25%; background: #0ef; color: white; padding: 10px !important;">Back to Other Blogs</a>
    </div>
    
    <!--Comments-->
    <div class="info-card w-25 px-4 py-3 my-4 ms-3" style="height: 56vh;">
            <h1 class="header">Comments</h1>
            <hr>

            
            {% if comments %}
            {% for comment in comments %}
              <div class="header">{{ comment.sender }}</div>
              <div class="card-body mb-3"><i>{{ comment.comment }}</i></div>
            
            {% endfor %}
          {% else %}
            <i>No comments yet.</i>
          {% endif %}
      </div>
    </div>


    <!--Add comments-->
    <form method="POST" class="info-card pass-gen px-4 py-3 mb-4 mt-0 mx-0" style="width: 77%;">
      <h5 class="header"><i>Submit a comment/response</i></h5>
      <textarea class="form-control pill rounded rounded-4 input-field py-2 px-3 text-white mb-4" id="comment-body" name="comment" rows="3" placeholder="Your Comment" required ></textarea>
      <button type="submit" class="border-0 rounded-pill py-2 view-password-btn card-link text-decoration-none" style="min-width: 25%; background: #0ef; color: white; padding: 10px !important;">Submit</button>
    </form>
    
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Bootstrap JS -->
  <script>
    $('.like-btn').click(function() {
      var comment_id = $(this).data('comment-id');
      var like_count = $(this).find('.like-count');
      $.ajax({
        type: 'POST',
        url: '/like_comment',
        data: {'comment_id': comment_id},
        success: function(data) {
          if (data.status == 'success') {
            like_count.text(data.likes);
          } else {
            alert(data.message);
          }
        },
        error: function() {
          alert('Error liking comment');
        }
      });
    });
    
    $('.dislike-btn').click(function() {
      var comment_id = $(this).data('comment-id');
      var dislike_count = $(this).find('.dislike-count');
      $.ajax({
        type: 'POST',
        url: '/dislike_comment',
        data: {'comment_id': comment_id},
        success: function(data) {
          if (data.status == 'success') {
            dislike_count.text(data.dislikes);
          } else {
            alert(data.message);
          }
        },
        error: function() {
          alert('Error disliking comment');
        }
      });
    });
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"></script>
</div>

{% endblock %}